"use strict";function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _get=function(e,t,i){for(var n=!0;n;){var s=e,o=t,a=i;l=d=r=void 0,n=!1,null===s&&(s=Function.prototype);var l=Object.getOwnPropertyDescriptor(s,o);if(void 0!==l){if("value"in l)return l.value;var r=l.get;if(void 0===r)return;return r.call(a)}var d=Object.getPrototypeOf(s);if(null===d)return;e=d,t=o,i=a,n=!0}},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),InView=function(){function e(t){_classCallCheck(this,e),this.items=[],this.activeItems=[],this.scrollPos=0,this.windowHeight=window.innerHeight;for(var i=0;i<t.length;i++)for(var n=0;n<t[i].length;n++){var s={id:n,obj:t[i][n]};this.items.push(s)}this.update()}return _createClass(e,[{key:"update",value:function(){for(var e=0;e<this.items.length;e++){var t=-500,i=this.items[e].obj.getBoundingClientRect().top,n=this.items[e].obj.getBoundingClientRect().bottom;i-t<this.windowHeight&&n>-t&&this.activate($(this.items[e].obj))}}},{key:"activate",value:function(e){e.addClass("active")}}]),e}(),Parallax=function(){function e(t){_classCallCheck(this,e),this.items=[],this.activeItems=[],this.scrollPos=0,this.windowHeight=window.innerHeight;for(var i=0;i<t.length;i++){var n={id:i,obj:t[i],speed:t[i].dataset.speed,translateX:t[i].dataset.x,step:0};this.items.push(n)}this.update(),this.render()}return _createClass(e,[{key:"update",value:function(){for(var e=0;e<this.items.length;e++){var t=500,i=this.items[e].obj.getBoundingClientRect().top,n=this.items[e].obj.getBoundingClientRect().bottom;i-t<this.windowHeight&&n>-t?this.activeItems[this.items[e].id]=this.items[e]:this.activeItems[this.items[e].id]&&this.activeItems.splice(this.items[e].id)}}},{key:"render",value:function(){self=this,Array.prototype.forEach.call(this.activeItems,function(e){var t=0;e.translateX&&(t=e.translateX);var i=e.obj.getBoundingClientRect().height/2-e.obj.getBoundingClientRect().top,n=100*i/self.windowHeight*e.speed,s="translate("+t+","+n.toFixed(2)+"px)";e.obj.style.transform=s,e.obj.style.webkitTransform=s,e.obj.style.mozTransform=s,e.obj.style.msTransform=s}),requestAnimationFrame(this.render.bind(this))}}]),e}(),Slider=function(){function e(t,i,n,s,o){_classCallCheck(this,e),this.wrapper=t,this.slides=i,this.speed=n,this.auto=s,this.mode=o,this.slider=null,this.initSlider(),this.bindUIActions()}return _createClass(e,[{key:"initSlider",value:function(){var e=this;this.slider=this.wrapper.bxSlider({mode:this.mode,speed:this.speed,pause:7e3,controls:!1,auto:this.auto,autoControls:!1,autoControlsCombine:!1,pager:!1,touchEnabled:!0,adaptiveHeight:!0,responsive:!0,onSlideBefore:function(t){e.onSlideBefore(t)},onSlideAfter:function(t,i,n){e.onSlideAfter(t,i,n)},onSliderLoad:function(){e.onSliderLoad()}})}},{key:"onSlideBefore",value:function(){TweenMax.staggerTo(".current-slide .tween-side",1,{x:"20%",opacity:0,ease:Power2.easeInOut},.2),$(".pager-slider").addClass("active")}},{key:"onSlideAfter",value:function(e,t,i){this.sendEvent(i),this.updatePager(t,i),$(".item-detail").removeClass("current-slide"),e.addClass("current-slide"),TweenMax.set(".current-slide .tween-side",{clearProps:"transform"}),TweenMax.staggerTo(".current-slide .tween-side",1.5,{x:"0%",opacity:1,delay:.5,ease:Power2.easeInOut},.2),setTimeout(function(){$(".pager-slider").removeClass("active")},4e3)}},{key:"onSliderLoad",value:function(){TweenMax.set(".current-slide .tween-side",{clearProps:"transform"}),TweenMax.staggerTo(".current-slide .tween-side",1.5,{x:"0%",opacity:1,delay:.5,ease:Power2.easeInOut},.2)}},{key:"goTo",value:function(e){this.slider.goToSlide(e)}},{key:"prev",value:function(e){e.preventDefault(),this.slider.goToPrevSlide(),this.slider.stopAuto()}},{key:"next",value:function(e){e.preventDefault(),this.slider.goToNextSlide(),this.slider.stopAuto()}},{key:"updatePager",value:function(e,t){var i=parseInt(e+1),n=parseInt(t+2);n>this.slider.getSlideCount()&&(n=1);var s=document.getElementById("prev"),o=document.getElementById("next");s.innerHTML="0"+parseInt(i),o.innerHTML="0"+parseInt(n)}},{key:"sendEvent",value:function(e){var t=new CustomEvent("nextSlide",{detail:{pointer:e},bubbles:!0,cancelable:!1});document.dispatchEvent(t)}},{key:"bindUIActions",value:function(){var e=document.getElementById("prev"),t=document.getElementById("next");e.addEventListener("click",this.prev.bind(this),!1),t.addEventListener("click",this.next.bind(this),!1)}}]),e}(),Player=function(){function e(t){_classCallCheck(this,e),this.video=t,this.timeline=null,this.bindUIActions()}return _createClass(e,[{key:"openPlayer",value:function(e){this.setPoster(e.dataset.poster),this.video.currentTime=e.dataset.time,this.timeline=new TimelineMax({onReverseComplete:this.pause.bind(this),onComplete:this.play.bind(this)}),this.timeline.set(".wrap-cta-close-player",{opacity:0}),this.timeline.set(".video-player",{x:"-100%"}),this.timeline.set(".player",{visibility:"visible"}),this.timeline.to(".overlay-player-1",2.5,{x:"200%",ease:Power2.easeInOut}),this.timeline.set(".player",{background:"rgb(6, 0, 130)"},1.25),this.timeline.set(".video-player",{x:"0%"},1.25),this.timeline.to(".overlay-player-2",4,{x:"190%",ease:Power2.easeInOut},-.2),this.timeline.to(".wrap-cta-close-player",.25,{opacity:1,ease:Power2.easeInOut})}},{key:"close",value:function(){this.timeline.reverse(),TweenMax.to(this.video,1,{volume:0,delay:2,ease:Power2.easeInOut})}},{key:"setPoster",value:function(e){this.video.setAttribute("poster",e)}},{key:"play",value:function(){this.video.volume=0,this.video.play(),TweenMax.to(this.video,2,{volume:1,ease:Power2.easeInOut})}},{key:"pause",value:function(){this.video.pause()}},{key:"bindUIActions",value:function(){var e=this;$(".link-item-flap").on("click",function(t){t.preventDefault(),e.openPlayer(this)}),this.video.addEventListener("click",this.play.bind(this));var t=document.getElementById("cta-close-player");t.addEventListener("click",this.close.bind(this))}}]),e}(),ScreenSlider=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,e),_createClass(t,[{key:"onSlideBefore",value:function(){}},{key:"onSlideAfter",value:function(){}},{key:"onSliderLoad",value:function(){}}]),t}(Slider),Map=function(){function e(t){_classCallCheck(this,e),self=this,this.zoom=15,this.latLng={lat:45.896,lng:6.128},this.map=new google.maps.Map(document.getElementById("gmap"),{center:self.latLng,scrollwheel:!1,zoom:parseInt(self.zoom),styles:self.getStyle(),disableDefaultUI:!0}),this.infowindow=new InfoBubble({map:this.map,content:"coucou info view",shadowStyle:0,padding:0,backgroundColor:"",borderRadius:0,arrowSize:0,arrowPosition:0,borderWidth:0,disableAutoPan:!0,hideCloseButton:!0,backgroundClassName:"infobubble",arrowStyle:0,minWidth:230,maxWidth:230,minHeight:190});for(var i=0;i<t.length;i++)this.addMarker(t[i]);this.bindUIActions()}return _createClass(e,[{key:"zoomIn",value:function(e){e.preventDefault(),this.zoom=this.zoom+1,this.map.setZoom(this.zoom)}},{key:"zoomOut",value:function(e){e.preventDefault(),this.zoom=this.zoom-1,this.map.setZoom(this.zoom)}},{key:"addMarker",value:function(e){self=this;var t=new google.maps.Marker({position:e.latLng,map:self.map,icon:this.getIcon(e.state),data:{title:e.title,time:e.time,place:e.location},optimized:!1});t.addListener("click",function(){this.showInfo(t)}.bind(this),!1)}},{key:"getIcon",value:function(e){var t="";return"live"==e&&(t="tpl/img/marker-1.svg"),"old"==e&&(t="tpl/img/marker-2.svg"),"new"==e&&(t="tpl/img/marker-3.svg"),t}},{key:"showInfo",value:function(e){this.infowindow.setContent('<div class="infobubble-bg"></div><div class="content-infobubble"><h4 class="title-infobubble">'+e.data.title+'</h4><p class="time-infobubble">'+e.data.time+'</p><p class="location-infobubble">'+e.data.place+'</p><a href="#" class="link-infobubble">Voir le replay</a></div>'),this.infowindow.open(self.map,e)}},{key:"getStyle",value:function(){return[{featureType:"administrative",elementType:"all",stylers:[{color:"#0200fd"},{visibility:"on"},{weight:"1"}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#0200fd"},{weight:"1.30"},{visibility:"on"}]},{featureType:"administrative",elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#000181"},{visibility:"simplified"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{saturation:-100},{lightness:45},{color:"#0c005f"},{visibility:"simplified"}]},{featureType:"road.highway",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{color:"#0200ff"},{visibility:"on"}]}]}},{key:"bindUIActions",value:function(){var e=document.getElementById("zoom-in"),t=document.getElementById("zoom-out");e.addEventListener("click",this.zoomIn.bind(this),!1),t.addEventListener("click",this.zoomOut.bind(this),!1)}}]),e}(),store,app={store:{screenSlider:"",inView:null,parallax:null},init:function(){store=this.store,this.bindUI();var e=document.getElementsByTagName("section"),t=document.getElementsByTagName("header"),i=document.getElementsByTagName("footer");store.inView=new InView([e,t,i]);var n=document.getElementsByClassName("parallax");store.parallax=new Parallax(n);var s=$("#slider-1"),o=$(".item-detail"),a=(new Slider(s,o,0,!0,"fade"),$("#slider-2")),l=$(".item-screen");store.screenSlider=new ScreenSlider(a,l,1e3,!1,"fade");var r=document.getElementById("video-player");new Player(r);document.addEventListener("nextSlide",this.updateSliders,!1)},initMap:function(){var e=[{id:0,title:"L.E.J.",state:"old",time:"12/07/2015",location:"Le Brise Glace",latLng:{lat:45.9,lng:6.124}},{id:1,title:"Louise Roam",state:"live",time:"12/07/2015",location:"Le Brise Glace",latLng:{lat:45.896,lng:6.128}},{id:2,title:"Nekfeu Nek le Fenek",state:"live",time:"20/05/2015",location:"CCI",latLng:{lat:45.893514,lng:6.135523}},{id:3,title:"L.E.J.",state:"new",time:"12/07/2015",location:"Le Brise Glace",latLng:{lat:45.893114,lng:6.12}}];new Map(e)},updateSliders:function(e){var t=e.detail.pointer;store.screenSlider.goTo(t)},bindUI:function(){$("body").keypress(function(){119==event.which&&(event.preventDefault(),$("body").toggleClass("dev"))}),window.onscroll=function(){document.documentElement.scrollTop||document.body.scrollTop;store.parallax.update(),store.inView.update()}}};app.init();
